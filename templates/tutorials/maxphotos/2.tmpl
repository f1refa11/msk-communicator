<div class="max-photo-sim-root">
    <style>
        :root {
            --bg-color: #17212b;
            --header-color: #202a38;
            --text-primary: #eef4ff;
            --text-secondary: #7f91a4;
            --accent-blue: #1f87ff;
            --message-in: #1b2735;
            --message-out: #2b5278;
        }

        .max-photo-sim-root,
        .max-photo-sim-root * {
            box-sizing: border-box;
        }

        .max-photo-sim-root {
            margin: 0;
            padding: 24px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #e7edf5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow: auto;
        }

        .tutorial-layout {
            width: min(1080px, 100%);
            display: flex;
            gap: 24px;
            align-items: flex-start;
            justify-content: center;
        }

        .phone-frame {
            width: 390px;
            height: 560px;
            background-color: var(--bg-color);
            border: 10px solid #1d232b;
            border-radius: 30px;
            box-shadow: 0 18px 36px rgba(19, 34, 53, 0.28);
            overflow: hidden;
            position: relative;
            flex-shrink: 0;
        }

        .screen {
            display: none;
            height: 100%;
            width: 100%;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        .global-click-hint {
            position: fixed;
            z-index: 10000;
            display: none;
            pointer-events: none;
            border: 3px solid #2b97ff;
            border-radius: 14px;
            box-shadow: 0 0 0 2px rgba(43, 151, 255, 0.35), 0 0 18px rgba(43, 151, 255, 0.65);
            animation: hintPulse 1.2s ease-in-out infinite;
        }

        @keyframes hintPulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            60% {
                transform: scale(1.05);
                opacity: 0.65;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .list-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 16px 8px;
            background: linear-gradient(180deg, #111722 0%, #141d2a 100%);
        }

        .list-header-title {
            margin: 0;
            color: var(--text-primary);
            font-size: 26px;
            font-weight: 700;
            line-height: 1;
        }

        .list-actions {
            display: flex;
            gap: 10px;
        }

        .list-action-btn {
            width: 42px;
            height: 42px;
            border: none;
            border-radius: 12px;
            background: #2a3444;
            color: #d5e1f0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .list-action-btn.accent {
            background: var(--accent-blue);
            color: #fff;
        }

        .list-filters {
            display: flex;
            gap: 12px;
            padding: 10px 16px 6px;
            background: #141d2a;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        }

        .list-filter {
            font-size: 15px;
            font-weight: 600;
            color: #8d9db0;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .list-filter.active {
            color: #fff;
            position: relative;
        }

        .list-filter.active::after {
            content: "";
            position: absolute;
            left: 0;
            right: 0;
            bottom: -8px;
            height: 3px;
            border-radius: 999px;
            background: var(--accent-blue);
        }

        .list-badge {
            min-width: 24px;
            height: 24px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.16);
            color: #c7d1de;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0 7px;
        }

        .chat-list {
            padding: 10px;
            flex: 1;
            overflow-y: hidden;
            overflow-x: hidden;
            background: linear-gradient(180deg, #141d2a 0%, #121a26 100%);
        }

        .chat-item {
            display: flex;
            padding: 6px 4px;
            gap: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .chat-item:active {
            background: #1a2634;
        }

        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #4d64f4;
            color: white;
            font-size: 22px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .avatar.yellow {
            background: #f1c40f;
            color: #1f242c;
        }

        .avatar.orange {
            background: linear-gradient(135deg, #ff4f8b, #ffb347);
        }

        .chat-main {
            flex: 1;
            min-width: 0;
        }

        .chat-name {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 650;
            line-height: 1.2;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-preview {
            color: #8ea0b4;
            font-size: 15px;
            margin-top: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-meta {
            width: 54px;
            flex-shrink: 0;
            text-align: right;
            color: #8ea0b4;
            font-size: 14px;
        }

        .chat-counter {
            margin-top: 8px;
            display: inline-flex;
            min-width: 30px;
            height: 30px;
            border-radius: 999px;
            background: var(--accent-blue);
            color: #fff;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 700;
        }

        .bottom-tabs {
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            background: #1a2432;
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            padding: 8px 6px 10px;
            gap: 2px;
        }

        .tab-item {
            border: none;
            background: transparent;
            color: #9facbd;
            display: grid;
            justify-items: center;
            gap: 4px;
            font-size: 15px;
            font-weight: 550;
            padding: 4px 0;
        }

        .tab-item.active {
            color: var(--accent-blue);
        }

        .chat-header {
            background: var(--header-color);
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-header-btn {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: transparent;
            color: #a4b1c2;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .chat-header-name {
            font-size: 18px;
            color: var(--text-primary);
            font-weight: 650;
            line-height: 1.2;
        }

        .chat-header-status {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .messages-area {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            gap: 8px;
            padding: 10px;
            background-color: #0f1823;
            background-image: radial-gradient(rgba(255, 255, 255, 0.04) 1px, transparent 0);
            background-size: 20px 20px;
        }

        .date-divider {
            align-self: center;
            background: rgba(0, 0, 0, 0.28);
            color: #d0d9e4;
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 999px;
            margin-bottom: 6px;
        }

        .message {
            max-width: 78%;
            padding: 8px 11px;
            border-radius: 11px;
            font-size: 15px;
            line-height: 1.35;
            color: #eef4ff;
            animation: popIn 0.2s ease;
        }

        .message.in {
            align-self: flex-start;
            background: var(--message-in);
            border-bottom-left-radius: 3px;
        }

        .message.out {
            align-self: flex-end;
            background: var(--message-out);
            border-bottom-right-radius: 3px;
        }

        .message-photo-thumb {
            width: 220px;
            height: 120px;
            border-radius: 8px;
            margin-bottom: 6px;
            background: linear-gradient(45deg, #a67c52, #8a6238);
            position: relative;
            overflow: hidden;
        }

        .message-photo-drawing {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .message-photo-thumb::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 40%, rgba(255, 255, 255, 0.18), transparent 30%);
        }

        .message-photo-thumb.gallery-photo::after {
            display: none;
        }

        .message-photo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: translateY(6px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .msg-time {
            margin-left: 8px;
            font-size: 11px;
            color: #8fa6bf;
        }

        .input-area {
            background: var(--header-color);
            display: flex;
            align-items: flex-end;
            gap: 6px;
            padding: 8px;
            border-top: 1px solid rgba(255, 255, 255, 0.06);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            position: relative;
            z-index: 30;
        }

        .input-icon {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            color: #9fb0c3;
            background: transparent;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .input-field {
            flex: 1;
            min-height: 40px;
            border-radius: 20px;
            background: #131d29;
            color: #eef4ff;
            padding: 10px 14px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .placeholder {
            color: #7f91a4;
        }

        .send-btn {
            width: 42px;
            height: 42px;
            border: none;
            border-radius: 50%;
            background: #111a24;
            color: var(--accent-blue);
            display: none;
            align-items: center;
            justify-content: center;
        }

        .draft-preview {
            flex: 1;
            min-height: 40px;
            border-radius: 12px;
            background: #2a3444;
            border: 1px solid rgba(255, 255, 255, 0.12);
            color: #dbe8f8;
            display: inline-flex;
            align-items: center;
            padding: 8px 12px;
            font-size: 14px;
            gap: 8px;
        }

        .bottom-sheet {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            background: #1c2532;
            border-top-left-radius: 18px;
            border-top-right-radius: 18px;
            z-index: 80;
            transform: translateY(102%);
            transition: transform 0.28s cubic-bezier(0.2, 0.8, 0.2, 1);
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 -10px 22px rgba(0, 0, 0, 0.35);
        }

        .bottom-sheet.open {
            transform: translateY(0);
        }

        .sheet-handle {
            width: 40px;
            height: 4px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.24);
            margin: 8px auto 10px;
        }

        .sheet-menu {
            display: flex;
            gap: 16px;
            align-items: center;
            padding: 0 14px 10px;
            overflow-x: auto;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .sheet-tab {
            font-size: 14px;
            font-weight: 600;
            color: #8ca0b5;
            white-space: nowrap;
            padding-bottom: 7px;
            border-bottom: 2px solid transparent;
        }

        .sheet-tab.active {
            color: #fff;
            border-bottom-color: var(--accent-blue);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 2px;
            padding: 2px;
            max-height: 240px;
            overflow-y: auto;
        }

        .gallery-item {
            aspect-ratio: 1;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            opacity: 0.82;
            transition: opacity 0.2s;
        }

        .gallery-item.selected img {
            opacity: 1;
        }

        .selection-indicator {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 24px;
            height: 24px;
            border: 2px solid #fff;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            z-index: 2;
        }

        .gallery-item.selected .selection-indicator {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .gallery-item.selected .selection-indicator::after {
            content: "";
            width: 10px;
            height: 5px;
            border-left: 2px solid #fff;
            border-bottom: 2px solid #fff;
            transform: rotate(-45deg);
            margin-top: -2px;
        }

        .camera-tile {
            background: #303a46;
            color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .camera-ui {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #000;
        }

        .camera-top {
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            color: #fff;
        }

        .camera-close {
            width: 34px;
            height: 34px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.12);
            color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .viewfinder {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: linear-gradient(45deg, #a67c52, #8a6238);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.35);
            font-size: 20px;
            font-weight: 700;
            letter-spacing: 0.04em;
        }

        .camera-controls {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 8px 16px 20px;
            color: #fff;
        }

        .shutter-btn {
            width: 74px;
            height: 74px;
            border-radius: 50%;
            border: 4px solid #fff;
            background: transparent;
            position: relative;
        }

        .shutter-btn::after {
            content: "";
            position: absolute;
            width: 58px;
            height: 58px;
            border-radius: 50%;
            background: #fff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .editor-ui {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #000;
        }

        .editor-header {
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 14px;
        }

        .done-btn {
            width: 34px;
            height: 34px;
            border: none;
            border-radius: 50%;
            background: #2b97ff;
            color: #fff;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .editor-preview {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: linear-gradient(45deg, #a67c52, #8a6238);
        }

        .drawing-layer {
            position: absolute;
            inset: 0;
            opacity: 0;
            transition: opacity 0.45s ease;
            pointer-events: none;
        }

        .editor-tools {
            height: 150px;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
        }

        .caption-input-row {
            padding: 10px 12px;
        }

        .caption-input {
            width: 100%;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 16px;
            outline: none;
            text-align: center;
        }

        .tools-row {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: space-around;
            color: #fff;
        }

        .tool-btn {
            border: none;
            background: transparent;
            color: #fff;
            display: grid;
            justify-items: center;
            gap: 4px;
            font-size: 12px;
        }

        .info-block {
            width: min(360px, 100%);
            background: #fff;
            border: 1px solid #d7deeb;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(16, 39, 66, 0.1);
            padding: 18px;
            display: grid;
            gap: 12px;
            align-self: flex-start;
        }

        .info-step {
            font-size: 12px;
            font-weight: 700;
            color: #677387;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .info-progress {
            display: grid;
            gap: 8px;
        }

        .info-progress-label {
            font-size: 12px;
            color: #5f6368;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 700;
        }

        .info-progress-track {
            display: grid;
            grid-template-columns: repeat(var(--segments-count, 9), minmax(0, 1fr));
            gap: 8px;
        }

        .progress-segment {
            height: 10px;
            border-radius: 999px;
            background: #dfe6ef;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
        }

        .progress-segment.is-complete {
            background: #1f9d55;
        }

        .progress-segment.is-current {
            background: #0070d2;
            box-shadow: 0 0 0 3px rgba(0, 112, 210, 0.2);
        }

        .info-title {
            margin: 0;
            font-size: 24px;
            line-height: 1.25;
            color: #111c2c;
        }

        .info-description {
            margin: 0;
            font-size: 16px;
            line-height: 1.5;
            color: #2a3646;
        }

        .info-note {
            margin: 0;
            background: #edf5ff;
            border-radius: 12px;
            color: #1f5c96;
            font-size: 14px;
            line-height: 1.4;
            padding: 10px 12px;
        }

        .info-nav {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
        }

        .info-nav-btn,
        .info-restart-btn {
            border: none;
            border-radius: 12px;
            padding: 11px 14px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
        }

        .info-nav-btn {
            background: #eef2f9;
            color: #27384d;
        }

        .info-nav-btn.primary {
            background: #0070d2;
            color: #fff;
        }

        .info-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .info-restart-btn {
            width: 100%;
            background: #2d7d46;
            color: #fff;
            display: none;
        }

        .max-photo-sim-root svg {
            fill: currentColor;
        }

        .list-action-btn svg,
        .tab-item svg,
        .chat-header-btn svg,
        .input-icon svg,
        .send-btn svg,
        .camera-close svg,
        .camera-controls svg,
        .camera-tile svg,
        .done-btn svg,
        .tool-btn svg {
            width: 22px;
            height: 22px;
            flex-shrink: 0;
        }
    </style>

    <div class="tutorial-layout">
        <div class="phone-frame">
            <section id="screen-list" class="screen active">
                <header class="list-header">
                    <h1 class="list-header-title">–ß–∞—Ç—ã</h1>
                    <div class="list-actions">
                        <button type="button" class="list-action-btn" aria-label="–ü–æ–∏—Å–∫">
                            <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.47 6.47 0 0 0 16 9.5a6.5 6.5 0 1 0-6.5 6.5c1.61 0 3.09-.59 4.23-1.57l.27.28h.79l4.99 5 1.5-1.5-4.99-5zM9.5 14A4.5 4.5 0 1 1 14 9.5 4.5 4.5 0 0 1 9.5 14z"/></svg>
                        </button>
                        <button type="button" class="list-action-btn accent" aria-label="–ù–æ–≤—ã–π —á–∞—Ç">
                            <svg viewBox="0 0 24 24"><path d="M19 11h-6V5h-2v6H5v2h6v6h2v-6h6z"/></svg>
                        </button>
                    </div>
                </header>

                <div class="list-filters">
                    <span class="list-filter active">–í—Å–µ</span>
                    <span class="list-filter">–°—Ñ–µ—Ä—É–º <span class="list-badge">1</span></span>
                    <span class="list-filter">–ù–æ–≤—ã–µ <span class="list-badge">4</span></span>
                </div>

                <div class="chat-list">
                    <article id="target-contact" class="chat-item" onclick="handleAction('open-chat')">
                        <div class="avatar yellow">–ï</div>
                        <div class="chat-main">
                            <div class="chat-name">–ï–≥–æ—Ä –†–æ–º–∞–Ω–æ–≤</div>
                            <div class="chat-preview">–ü—Ä–∏–≤–µ—Ç!</div>
                        </div>
                        <div class="chat-meta">
                            <div>00:11</div>
                            <div class="chat-counter">1</div>
                        </div>
                    </article>

                    <article class="chat-item">
                        <div class="avatar">1–ö</div>
                        <div class="chat-main">
                            <div class="chat-name">–û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏</div>
                            <div class="chat-preview">–°–≤–µ—Ç–ª–∞–Ω–∞: –§–æ—Ç–æ</div>
                        </div>
                        <div class="chat-meta">
                            <div>18:00</div>
                            <div class="chat-counter">18</div>
                        </div>
                    </article>

                    <article class="chat-item">
                        <div class="avatar orange">–ë–°</div>
                        <div class="chat-main">
                            <div class="chat-name">–°–µ–º—å—è –ö—É–∑–Ω–µ—Ü–æ–≤—ã—Ö</div>
                            <div class="chat-preview">–í—ã –≤—ã—à–ª–∏ –∏–∑ —á–∞—Ç–∞</div>
                        </div>
                        <div class="chat-meta">6 —Ñ–µ–≤—Ä.</div>
                    </article>
                </div>

                <nav class="bottom-tabs" aria-label="–ì–ª–∞–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã">
                    <button type="button" class="tab-item">
                        <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5C15 14.17 10.33 13 8 13zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.98 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
                        <span>–ö–æ–Ω—Ç–∞–∫—Ç—ã</span>
                    </button>
                    <button type="button" class="tab-item">
                        <svg viewBox="0 0 24 24"><path d="M6.62 10.79a15.91 15.91 0 0 0 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1C10.61 21 3 13.39 3 4c0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.24.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                        <span>–ó–≤–æ–Ω–∫–∏</span>
                    </button>
                    <button type="button" class="tab-item active">
                        <svg viewBox="0 0 24 24"><path d="M4 4h16v12H5.17L4 17.17V4zm2 2v8.34L7.66 14H18V6H6z"/></svg>
                        <span>–ß–∞—Ç—ã</span>
                    </button>
                    <button type="button" class="tab-item">
                        <svg viewBox="0 0 24 24"><path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/></svg>
                        <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                    </button>
                </nav>
            </section>

            <section id="screen-chat" class="screen">
                <header class="chat-header">
                    <button type="button" class="chat-header-btn" onclick="goToStep('select-chat')" aria-label="–ù–∞–∑–∞–¥ –∫ —á–∞—Ç–∞–º">
                        <svg viewBox="0 0 24 24"><path d="M20 11H7.83l5.58-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
                    </button>
                    <div class="avatar yellow" style="width:36px;height:36px;font-size:18px;">–ï</div>
                    <div>
                        <div class="chat-header-name">–ï–≥–æ—Ä –†–æ–º–∞–Ω–æ–≤</div>
                        <div class="chat-header-status">–±—ã–ª(-–∞) –Ω–µ–¥–∞–≤–Ω–æ</div>
                    </div>
                </header>

                <div id="msg-area" class="messages-area"></div>

                <div class="input-area" id="input-area">
                    <button type="button" class="input-icon" aria-label="–°—Ç–∏–∫–µ—Ä—ã">
                        <svg viewBox="0 0 24 24"><path d="M20 2H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM8.5 9A1.5 1.5 0 1 1 10 7.5 1.5 1.5 0 0 1 8.5 9zm7 0A1.5 1.5 0 1 1 17 7.5 1.5 1.5 0 0 1 15.5 9zM12 18c-2.76 0-5-1.79-5-4h10c0 2.21-2.24 4-5 4z"/></svg>
                    </button>

                    <div id="main-input" class="input-field">
                        <span id="input-placeholder" class="placeholder">–°–æ–æ–±—â–µ–Ω–∏–µ</span>
                    </div>

                    <button id="attach-btn" type="button" class="input-icon" onclick="handleAction('open-menu')" aria-label="–í–ª–æ–∂–µ–Ω–∏—è">
                        <svg viewBox="0 0 24 24"><path d="M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5S13.5 3.62 13.5 5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 1 0 5 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5a5.5 5.5 0 0 0 11 0V6h-1.5z"/></svg>
                    </button>

                    <button id="mic-btn" type="button" class="input-icon" aria-label="–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
                        <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
                    </button>

                    <button id="send-btn" type="button" class="send-btn" onclick="handleAction('send-message')" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ">
                        <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l14 2-14 2z"/></svg>
                    </button>
                </div>

                <div id="attach-sheet" class="bottom-sheet">
                    <div class="sheet-handle"></div>
                    <div class="sheet-menu">
                        <span class="sheet-tab active">–ì–∞–ª–µ—Ä–µ—è</span>
                        <span class="sheet-tab">–§–∞–π–ª</span>
                        <span class="sheet-tab">–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è</span>
                        <span class="sheet-tab">–ö–æ–Ω—Ç–∞–∫—Ç</span>
                    </div>
                    <div class="gallery-grid">
                        <div id="camera-tile" class="gallery-item camera-tile" onclick="handleAction('open-camera')">
                            <svg viewBox="0 0 24 24" style="width:30px;height:30px;"><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm6 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg>
                        </div>

                        <div id="gallery-demo-item" class="gallery-item" onclick="handleAction('demo-select-photo')">
                            <img src="https://picsum.photos/seed/1/200/200" alt="photo">
                            <div class="selection-indicator"></div>
                        </div>

                        <div class="gallery-item">
                            <img src="https://picsum.photos/seed/2/200/200" alt="photo">
                            <div class="selection-indicator"></div>
                        </div>
                        <div class="gallery-item">
                            <img src="https://picsum.photos/seed/3/200/200" alt="photo">
                            <div class="selection-indicator"></div>
                        </div>
                        <div class="gallery-item">
                            <img src="https://picsum.photos/seed/4/200/200" alt="photo">
                            <div class="selection-indicator"></div>
                        </div>
                        <div class="gallery-item">
                            <img src="https://picsum.photos/seed/5/200/200" alt="photo">
                            <div class="selection-indicator"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="screen-camera" class="screen">
                <div class="camera-ui">
                    <div class="camera-top">
                        <button type="button" class="camera-close" onclick="handleAction('cancel-camera')" aria-label="–ó–∞–∫—Ä—ã—Ç—å –∫–∞–º–µ—Ä—É">
                            <svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                        </button>
                        <div>–ö–∞–º–µ—Ä–∞</div>
                        <div style="width:34px;"></div>
                    </div>

                    <div class="viewfinder">–ö–∞–º–µ—Ä–∞</div>

                    <div class="camera-controls">
                        <div>
                            <svg viewBox="0 0 24 24"><path d="M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6 0 1.01-.25 1.96-.7 2.8l1.46 1.46A7.96 7.96 0 0 0 20 13c0-4.42-3.58-8-8-8zM6.7 7.2 5.24 5.74A7.96 7.96 0 0 0 4 13c0 4.42 3.58 8 8 8v4l5-5-5-5v4c-3.31 0-6-2.69-6-6 0-1.01.25-1.96.7-2.8z"/></svg>
                        </div>
                        <button id="shutter-btn" type="button" class="shutter-btn" onclick="handleAction('take-photo')" aria-label="–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ"></button>
                        <div>
                            <svg viewBox="0 0 24 24"><path d="M12 7.77L18.39 18H5.61L12 7.77M12 4 2 20h20L12 4z"/></svg>
                        </div>
                    </div>
                </div>
            </section>

            <section id="screen-editor" class="screen">
                <div class="editor-ui">
                    <div class="editor-header">
                        <button id="editor-done-btn" type="button" class="done-btn" onclick="handleAction('finish-edit')" aria-label="–ì–æ—Ç–æ–≤–æ">
                            <svg viewBox="0 0 24 24" style="width:18px;height:18px;"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                        </button>
                    </div>

                    <div class="editor-preview">
                        <svg id="drawn-line" class="drawing-layer" viewBox="0 0 300 220" preserveAspectRatio="none">
                            <path d="M10 160 Q80 90 130 130 T290 80" stroke="rgba(0, 0, 0, 0.65)" stroke-width="6" fill="none" />
                        </svg>
                    </div>

                    <div class="editor-tools">
                        <div class="caption-input-row">
                            <input type="text" class="caption-input" value="–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –º–æ–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞" readonly>
                        </div>
                        <div class="tools-row">
                            <button type="button" class="tool-btn"><svg viewBox="0 0 24 24"><path d="M17.65 6.35A7.95 7.95 0 0 0 12 4a8 8 0 1 0 7.75 10h-2.08A6 6 0 1 1 12 6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg><span>–§–∏–ª—å—Ç—Ä</span></button>
                            <button type="button" class="tool-btn"><svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/></svg><span>–†–∏—Å—É–Ω–æ–∫</span></button>
                            <button type="button" class="tool-btn"><svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2zm1 15h-2v-6h2zm0-8h-2V7h2z"/></svg><span>–¢–µ–∫—Å—Ç</span></button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <aside class="info-block" aria-live="polite">
            <div class="info-progress">
                <div class="info-progress-label">–ü—Ä–æ–≥—Ä–µ—Å—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</div>
                <div id="info-progress-track" class="info-progress-track"></div>
            </div>
            <div id="info-step" class="info-step">–®–∞–≥ 1 –∏–∑ 9</div>
            <h2 id="info-title" class="info-title">–û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç</h2>
            <p id="info-description" class="info-description">–ù–∞–π–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç ¬´–ï–≥–æ—Ä –†–æ–º–∞–Ω–æ–≤¬ª –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ.</p>
            <p id="info-note" class="info-note" style="display: none;"></p>

            <div id="info-nav" class="info-nav">
                <button id="nav-prev" type="button" class="info-nav-btn" onclick="goBack()">–ù–∞–∑–∞–¥</button>
                <button id="nav-next" type="button" class="info-nav-btn primary" onclick="goForward()">–í–ø–µ—Ä—ë–¥</button>
            </div>

            <button id="restart-btn" type="button" class="info-restart-btn" onclick="restartTutorial()">–ù–∞—á–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –∑–∞–Ω–æ–≤–æ</button>
        </aside>
    </div>

    <div id="global-click-hint" class="global-click-hint" aria-hidden="true"></div>

    <script>
        const steps = {
            'select-chat': {
                step: '–®–∞–≥ 1 –∏–∑ 9',
                title: '–û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç',
                description: '–ù–∞–π–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç ¬´–ï–≥–æ—Ä –†–æ–º–∞–Ω–æ–≤¬ª –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ.',
                note: '',
                screen: 'list',
                action: 'open-chat',
                hint: { targetId: 'target-contact', radius: 12, padding: 4 }
            },
            'open-menu-gallery': {
                step: '–®–∞–≥ 2 –∏–∑ 9',
                title: '–û—Ç–∫—Ä–æ–π—Ç–µ –≤–ª–æ–∂–µ–Ω–∏—è',
                description: '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Å–∫—Ä–µ–ø–∫–∏ —Å–ø—Ä–∞–≤–∞ –≤ —Å—Ç—Ä–æ–∫–µ –≤–≤–æ–¥–∞, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –≥–∞–ª–µ—Ä–µ—é.',
                note: '',
                screen: 'chat',
                action: 'open-menu',
                hint: { targetId: 'attach-btn', radius: 20, padding: 6 }
            },
            'demo-select-photo': {
                step: '–®–∞–≥ 3 –∏–∑ 9',
                title: '–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ',
                description: '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –≤ –≥–∞–ª–µ—Ä–µ–µ, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –µ—ë.',
                note: '–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –∏–∫–æ–Ω–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ —Å–º–µ–Ω–∏—Ç—Å—è –Ω–∞ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏.',
                screen: 'chat',
                sheetOpen: true,
                action: 'demo-select-photo',
                hint: { targetId: 'gallery-demo-item', radius: 8, padding: 0 }
            },
            'send-gallery': {
                step: '–®–∞–≥ 4 –∏–∑ 9',
                title: '–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏',
                description: '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —Ñ–æ—Ç–æ.',
                note: '',
                screen: 'chat',
                draftPhoto: 'gallery',
                action: 'send-message',
                hint: { targetId: 'send-btn', radius: 24, padding: 4 }
            },
            'open-menu-camera': {
                step: '–®–∞–≥ 5 –∏–∑ 9',
                title: '–°–Ω–æ–≤–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–ª–æ–∂–µ–Ω–∏—è',
                description: '–¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–∏–º –Ω–æ–≤–æ–µ —Ñ–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã. –ù–∞–∂–º–∏—Ç–µ –∏–∫–æ–Ω–∫—É —Å–∫—Ä–µ–ø–∫–∏ –µ—â—ë —Ä–∞–∑.',
                note: '',
                screen: 'chat',
                sentGalleryPhoto: true,
                action: 'open-menu',
                hint: { targetId: 'attach-btn', radius: 20, padding: 6 }
            },
            'open-camera': {
                step: '–®–∞–≥ 6 –∏–∑ 9',
                title: '–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–º–µ—Ä—É',
                description: '–í –º–µ–Ω—é –≤–ª–æ–∂–µ–Ω–∏–π –Ω–∞–∂–º–∏—Ç–µ –ø–µ—Ä–≤—É—é –ø–ª–∏—Ç–∫—É —Å –∏–∫–æ–Ω–∫–æ–π –∫–∞–º–µ—Ä—ã.',
                note: '–ó–¥–µ—Å—å —Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏.',
                screen: 'chat',
                sheetOpen: true,
                sentGalleryPhoto: true,
                action: 'open-camera',
                hint: { targetId: 'camera-tile', radius: 8, padding: 3 }
            },
            'take-photo': {
                step: '–®–∞–≥ 7 –∏–∑ 9',
                title: '–°–¥–µ–ª–∞–π—Ç–µ —Ñ–æ—Ç–æ',
                description: '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±–æ–ª—å—à—É—é –∫—Ä—É–≥–ª—É—é –∫–Ω–æ–ø–∫—É –∑–∞—Ç–≤–æ—Ä–∞.',
                note: '',
                screen: 'camera',
                sentGalleryPhoto: true,
                action: 'take-photo',
                hint: { targetId: 'shutter-btn', radius: 35, padding: 4 }
            },
            'finish-edit': {
                step: '–®–∞–≥ 8 –∏–∑ 9',
                title: '–†–µ–¥–∞–∫—Ç–æ—Ä',
                description: '–ù–∞–∂–º–∏—Ç–µ –≥–∞–ª–æ—á–∫—É (–ì–æ—Ç–æ–≤–æ) –≤–≤–µ—Ä—Ö—É —Å–ø—Ä–∞–≤–∞.',
                note: '–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∫–∞–¥—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —Ä–∏—Å–æ–≤–∞—Ç—å –Ω–∞ —Ñ–æ—Ç–æ.',
                screen: 'editor',
                sentGalleryPhoto: true,
                action: 'finish-edit',
                hint: { targetId: 'editor-done-btn', radius: 16, padding: 6 }
            },
            'send-camera': {
                step: '–®–∞–≥ 9 –∏–∑ 9',
                title: '–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã',
                description: '–ù–∞–∂–º–∏—Ç–µ —Å–∏–Ω—é—é –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏.',
                note: '',
                screen: 'chat',
                sentGalleryPhoto: true,
                draftPhoto: 'camera',
                action: 'send-message',
                hint: { targetId: 'send-btn', radius: 24, padding: 4 }
            },
            'completed': {
                step: '–ì–æ—Ç–æ–≤–æ',
                title: '–£—Å–ø–µ—Ö!',
                description: '–í—ã –Ω–∞—É—á–∏–ª–∏—Å—å –≤—ã–±–∏—Ä–∞—Ç—å —Ñ–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏ –∏ –¥–µ–ª–∞—Ç—å –Ω–æ–≤—ã–µ —Å–Ω–∏–º–∫–∏ –∫–∞–º–µ—Ä–æ–π.',
                note: '',
                screen: 'chat',
                sentGalleryPhoto: true,
                sentCameraPhoto: true,
                hint: null
            }
        };

        const navigationOrder = [
            'select-chat',
            'open-menu-gallery',
            'demo-select-photo',
            'send-gallery',
            'open-menu-camera',
            'open-camera',
            'take-photo',
            'finish-edit',
            'send-camera'
        ];

        const screens = {
            list: document.getElementById('screen-list'),
            chat: document.getElementById('screen-chat'),
            camera: document.getElementById('screen-camera'),
            editor: document.getElementById('screen-editor')
        };

        const elements = {
            sheet: document.getElementById('attach-sheet'),
            msgArea: document.getElementById('msg-area'),
            inputArea: document.getElementById('input-area'),
            inputField: document.getElementById('main-input'),
            placeholder: document.getElementById('input-placeholder'),
            attachBtn: document.getElementById('attach-btn'),
            micBtn: document.getElementById('mic-btn'),
            sendBtn: document.getElementById('send-btn'),
            drawnLine: document.getElementById('drawn-line'),
            globalHint: document.getElementById('global-click-hint'),
            infoStep: document.getElementById('info-step'),
            infoProgressTrack: document.getElementById('info-progress-track'),
            infoTitle: document.getElementById('info-title'),
            infoDescription: document.getElementById('info-description'),
            infoNote: document.getElementById('info-note'),
            infoNav: document.getElementById('info-nav'),
            navPrev: document.getElementById('nav-prev'),
            navNext: document.getElementById('nav-next'),
            restartBtn: document.getElementById('restart-btn')
        };

        let currentStep = 'select-chat';
        let activeHintConfig = null;
        let selectedGalleryImageSrc = '';

        function getDemoGalleryImageSrc() {
            const image = document.querySelector('#gallery-demo-item img');
            return image ? image.getAttribute('src') : '';
        }

        function getStepIndex(stepKey) {
            return navigationOrder.indexOf(stepKey);
        }

        function getNextStep(stepKey) {
            if (stepKey === 'send-camera') {
                return 'completed';
            }
            const idx = navigationOrder.indexOf(stepKey);
            if (idx === -1 || idx >= navigationOrder.length - 1) {
                return null;
            }
            return navigationOrder[idx + 1];
        }

        function ensureProgressSegments() {
            const segmentsCount = navigationOrder.length;
            elements.infoProgressTrack.style.setProperty('--segments-count', String(segmentsCount));

            if (elements.infoProgressTrack.childElementCount === segmentsCount) {
                return;
            }

            elements.infoProgressTrack.innerHTML = '';
            for (let i = 0; i < segmentsCount; i += 1) {
                const segment = document.createElement('span');
                segment.className = 'progress-segment';
                elements.infoProgressTrack.appendChild(segment);
            }
        }

        function updateProgressBar(stepKey) {
            ensureProgressSegments();
            const segments = Array.from(elements.infoProgressTrack.children);
            const isCompleted = stepKey === 'completed';
            const stepIndex = getStepIndex(stepKey);
            const currentIndex = isCompleted ? navigationOrder.length - 1 : stepIndex;

            segments.forEach((segment, index) => {
                segment.classList.remove('is-complete', 'is-current');
                if (isCompleted || index < currentIndex) {
                    segment.classList.add('is-complete');
                } else if (index === currentIndex) {
                    segment.classList.add('is-current');
                }
            });
        }

        function showScreen(screenName) {
            Object.values(screens).forEach((screen) => {
                screen.classList.remove('active');
            });

            if (screens[screenName]) {
                screens[screenName].classList.add('active');
            }
        }

        function toggleSheet(isOpen) {
            elements.sheet.classList.toggle('open', Boolean(isOpen));
        }

        function renderMessages(showGalleryPhoto, showCameraPhoto) {
            let messagesHTML = `
                <div class="date-divider">–°–µ–≥–æ–¥–Ω—è</div>
                <div class="message in">–ü—Ä–∏–≤–µ—Ç!<span class="msg-time">00:11</span></div>
                <div class="message in">–ö–∞–∫ –Ω–∞—Å—á—ë—Ç –ø–æ–∏–≥—Ä–∞—Ç—å –≤ Dota 2?<span class="msg-time">00:12</span></div>
                <div class="message out">–î–∞, –¥–∞–≤–∞–π! –î–∞–≤–∞–π —Å–æ–∑–≤–æ–Ω–∏–º—Å—è –≤ 19:30?<span class="msg-time">00:12</span></div>
                <div class="message in">–î–∞–≤–∞–π, –∂–¥—É!<span class="msg-time">00:13</span></div>
            `;

            if (showGalleryPhoto) {
                const gallerySrc = selectedGalleryImageSrc || getDemoGalleryImageSrc();
                messagesHTML += `
                    <div class="message out">
                        <div class="message-photo-thumb gallery-photo">
                            <img class="message-photo-image" src="${gallerySrc}" alt="–§–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏">
                        </div>
                        –§–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏
                        <span class="msg-time">00:14 ‚úì</span>
                    </div>
                `;
            }

            if (showCameraPhoto) {
                messagesHTML += `
                    <div class="message out">
                        <div class="message-photo-thumb">
                            <svg class="message-photo-drawing" viewBox="0 0 300 220" preserveAspectRatio="none">
                                <path d="M10 160 Q80 90 130 130 T290 80" stroke="rgba(0, 0, 0, 0.65)" stroke-width="6" fill="none" />
                            </svg>
                        </div>
                        –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –º–æ–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ç–æ–ª–∞
                        <span class="msg-time">00:15 ‚úì</span>
                    </div>
                `;
            }

            elements.msgArea.innerHTML = messagesHTML;
            elements.msgArea.scrollTop = elements.msgArea.scrollHeight;
        }

        function clearDraftPreview() {
            const draft = document.getElementById('draft-preview');
            if (draft) {
                draft.remove();
            }
        }

        function updateComposer(config) {
            clearDraftPreview();
            elements.inputField.style.display = 'flex';
            elements.attachBtn.style.display = 'inline-flex';
            elements.micBtn.style.display = 'inline-flex';
            elements.sendBtn.style.display = 'none';
            elements.placeholder.textContent = '–°–æ–æ–±—â–µ–Ω–∏–µ';

            if (config.draftPhoto) {
                const draftPreview = document.createElement('div');
                draftPreview.id = 'draft-preview';
                draftPreview.className = 'draft-preview';
                const isGalleryDraft = config.draftPhoto === 'gallery';
                draftPreview.innerHTML = isGalleryDraft
                    ? '<span>üñºÔ∏è</span><span>–§–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏ (—á–µ—Ä–Ω–æ–≤–∏–∫)</span>'
                    : '<span>üì∑</span><span>–§–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã (—á–µ—Ä–Ω–æ–≤–∏–∫)</span>';

                elements.inputField.style.display = 'none';
                elements.attachBtn.style.display = 'none';
                elements.micBtn.style.display = 'none';
                elements.sendBtn.style.display = 'inline-flex';

                elements.inputArea.insertBefore(draftPreview, elements.sendBtn);
            }
        }

        function updateEditorDecoration(showDecoration) {
            if (showDecoration) {
                setTimeout(() => {
                    elements.drawnLine.style.opacity = '1';
                }, 120);
            } else {
                elements.drawnLine.style.opacity = '0';
            }
        }

        function updateInfoPanel(config) {
            elements.infoStep.textContent = config.step;
            elements.infoTitle.textContent = config.title;
            elements.infoDescription.textContent = config.description;

            if (config.note) {
                elements.infoNote.style.display = 'block';
                elements.infoNote.textContent = config.note;
            } else {
                elements.infoNote.style.display = 'none';
                elements.infoNote.textContent = '';
            }
        }

        function updateNavigation(stepKey) {
            if (stepKey === 'completed') {
                elements.infoNav.style.display = 'none';
                elements.restartBtn.style.display = 'inline-flex';
                return;
            }

            elements.infoNav.style.display = 'grid';
            elements.restartBtn.style.display = 'none';

            const idx = getStepIndex(stepKey);
            elements.navPrev.disabled = idx <= 0;
            elements.navNext.disabled = idx < 0 || idx >= navigationOrder.length - 1;
        }

        function positionGlobalHint() {
            if (!activeHintConfig || !activeHintConfig.targetId) {
                elements.globalHint.style.display = 'none';
                return;
            }

            const target = document.getElementById(activeHintConfig.targetId);
            if (!target) {
                elements.globalHint.style.display = 'none';
                return;
            }

            const targetStyle = window.getComputedStyle(target);
            if (targetStyle.display === 'none' || targetStyle.visibility === 'hidden') {
                elements.globalHint.style.display = 'none';
                return;
            }

            const rect = target.getBoundingClientRect();
            if (rect.width === 0 || rect.height === 0) {
                elements.globalHint.style.display = 'none';
                return;
            }

            const padding = Number(activeHintConfig.padding || 0);
            const radius = Number(activeHintConfig.radius || 14);

            elements.globalHint.style.display = 'block';
            elements.globalHint.style.left = `${rect.left - padding}px`;
            elements.globalHint.style.top = `${rect.top - padding}px`;
            elements.globalHint.style.width = `${rect.width + padding * 2}px`;
            elements.globalHint.style.height = `${rect.height + padding * 2}px`;
            elements.globalHint.style.borderRadius = `${radius}px`;
        }

        function applyHint(hintConfig) {
            activeHintConfig = hintConfig
                ? {
                      targetId: String(hintConfig.targetId),
                      radius: Number(hintConfig.radius || 14),
                      padding: Number(hintConfig.padding || 0)
                  }
                : null;

            positionGlobalHint();
            requestAnimationFrame(positionGlobalHint);
            setTimeout(positionGlobalHint, 340);
        }

        function updateUI(stepKey) {
            const config = steps[stepKey];
            if (!config) {
                return;
            }

            showScreen(config.screen);
            toggleSheet(config.sheetOpen);
            renderMessages(Boolean(config.sentGalleryPhoto), Boolean(config.sentCameraPhoto));
            updateComposer(config);

            const demoItem = document.getElementById('gallery-demo-item');
            if (demoItem) {
                demoItem.classList.remove('selected');
            }

            if (config.gallerySelected && demoItem) {
                demoItem.classList.add('selected');
            }

            if (stepKey === 'demo-select-photo') {
                elements.micBtn.style.display = 'inline-flex';
                elements.sendBtn.style.display = 'none';
            }

            updateEditorDecoration(config.screen === 'editor');
            updateInfoPanel(config);
            updateNavigation(stepKey);
            updateProgressBar(stepKey);
            applyHint(config.hint);
        }

        function goToStep(stepKey) {
            if (!steps[stepKey]) {
                return;
            }
            currentStep = stepKey;
            updateUI(stepKey);
        }

        function handleAction(actionName) {
            if (actionName === 'cancel-camera') {
                goToStep('open-camera');
                return;
            }

            if (actionName === 'demo-select-photo') {
                selectedGalleryImageSrc = getDemoGalleryImageSrc();
            }

            const config = steps[currentStep];
            if (!config || config.action !== actionName) {
                return;
            }

            const nextStep = getNextStep(currentStep);
            if (nextStep) {
                goToStep(nextStep);
            }
        }

        function goBack() {
            if (currentStep === 'completed') {
                goToStep('send-camera');
                return;
            }

            const idx = getStepIndex(currentStep);
            if (idx > 0) {
                goToStep(navigationOrder[idx - 1]);
            }
        }

        function goForward() {
            if (currentStep === 'completed') {
                return;
            }

            const idx = getStepIndex(currentStep);
            if (idx >= 0 && idx < navigationOrder.length - 1) {
                goToStep(navigationOrder[idx + 1]);
            }
        }

        function restartTutorial() {
            selectedGalleryImageSrc = '';
            goToStep('select-chat');
        }

        window.addEventListener('resize', positionGlobalHint);
        document.addEventListener('scroll', positionGlobalHint, true);
        elements.sheet.addEventListener('transitionend', positionGlobalHint);

        goToStep('select-chat');
    </script>
</div>
